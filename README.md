# Edge-HPC: Моделирование распространения сердечного сигнала (ECG) на периферии

> Проект для Raspberry Pi 5 — реальное моделирование распространения электрического сигнала в миокарде как процесса диффузии в непрерывной среде с использованием реальных ECG-данных, TinyML и интеграции в IoT.

![Raspberry Pi](https://img.shields.io/badge/Raspberry_Pi-5-orange)
![Python](https://img.shields.io/badge/Python-3.11+-blue)
![License](https://img.shields.io/badge/License-MIT-green)

Проект моделирует распространение электрического потенциала в ткани сердца через приближение к уравнению диффузии с источником. Решение PDE/диффузионного уравнения вычисляется на Raspberry Pi 5 в режиме реального времени. Параметры модели адаптируются с помощью TinyML/машинного обучения, данные собираются с помощью модулей AD8232 и ESP32 и передаются по Wi‑Fi для обработки, визуализации и интеграции в IoT.

---

## Цели проекта

- Смоделировать распространение сердечного сигнала как реакционно-диффузный процесс.
- Численно решать одномерное уравнение диффузии с источником на RPi5 (FDM/Finite Differences).
- Использовать реальные 6‑канальные ECG данные (две платы AD8232 + вычисленные выводы).
- Адаптировать параметры модели (коэффициент диффузии, скорость источника) с помощью ML/TinyML.
- Визуализировать фронт волны в реальном времени на RPi5.
- Интегрировать данные в экосистему IoT (MQTT, Grafana/InfluxDB, веб‑дашборд).

---

## Аппаратные компоненты

| Компонент | Количество | Назначение |
|---|---:|---|
| Raspberry Pi 5 | 1–2 | Основное вычисление: решение уравнения, ML, визуализация |
| ESP32 | 1 | Сбор аналоговых сигналов, передача по Wi‑Fi |
| AD8232 | 2 | Аналоговый фронт‑энд для измерения Lead I и Lead II |
| Электроды ECG | 4+ | RA, LA, LL, RL |
| Snap‑коннекторы | 4 | Интерфейс электрод–AD8232 |
| 47 kΩ резистор | 1 | RLD/опорный контакт (второй AD8232) |
| Макетная плата и провода | — | Сборка схемы |

Ориентировочная стоимость (без RPi5/ESP32, если уже есть): ~25–30 USD.

---

## Стек ПО

- Язык: Python 3.11+
- Библиотеки (пример): `numpy`, `scipy`, `matplotlib`, `torch` / `tensorflow-lite`, `scikit-learn`, `paho-mqtt`
- Протоколы: Wi‑Fi, TCP, MQTT
- Опционально: `dask` (параллелизм), `flask` (веб‑дашборд), `influxdb` + `grafana` (мониторинг)

В репозитории уже есть модели и вспомогательные скрипты в каталоге `ai/`, а также наборы данных в `ecg_data/` и записи в `recordings/`.

---

## Как это работает (кратко)

1. Сбор ECG
- AD8232 #1 измеряет Lead I (LA — RA).
- AD8232 #2 измеряет Lead II (LL — RA).
- ESP32 читает аналоговые значения, вычисляет дополнительные отведения (III, aVR, aVL, aVF) и пересылает пакет из 6 каналов по Wi‑Fi на RPi5.

2. Обработка и моделирование
- RPi5 принимает поток данных в реальном времени.
- Решается уравнение диффузии (1D):
\[
\frac{\partial \phi}{\partial t} = D \frac{\partial^2 \phi}{\partial x^2} + S(x,t)
\]
- Для численного решения применяется метод конечных разностей (FDM) и/или обучаемые нейросетевые приближения (PINN).

3. Машинное обучение
- Извлекаются признаки (энтропия, дисперсия, форма QRS и т. п.).
- Классификация/оценка состояния (спокойствие/стресс/нагрузка) с помощью TinyML/скриптов в `ai/`.
- Параметры модели (например, D) адаптируются на лету.

4. Интеграция IoT
- Публикация метрик в MQTT-брокер.
- Визуализация/архивация в Grafana/InfluxDB или внешних сервисах.

---

## Быстрый старт — установка и запуск

1) Создайте виртуальное окружение и установите зависимости (пример, если у вас есть `requirements.txt`):

```bash
python3.11 -m venv .venv
source .venv/bin/activate
pip install -U pip
pip install -r rp/requirements.txt
```

2) Запуск скрипта обработки/предсказания (пример):

```bash
# из корня репозитория
python ai/main.py
```

3) Если у вас есть ESP32/прошивка: загрузите прошивку на устройство (пример для Arduino/PlatformIO см. каталог `arduino nano/`):

```bash
# пример: компиляция и загрузка через platformio (зависит от конфигурации проекта)
# platformio run --target upload --project-dir "arduino nano/arduino_ecg"
```

Примеры конфигурации MQTT/серверов и визуализации можно найти или добавить в `rp/` и `ai/` по мере необходимости.

---

## Важные файлы и папки

- `ai/` — модели, скрипты для обучения/инференса и вспомогательные файлы (например, `main.py`, `nn_main.py`, обученные веса `ecg_model.pth`, `ecg_model_traced.pt`).
- `ecg_data/` — подготовленные датасеты (X_train, y_train и т. д.).
- `recordings/` — сырые/фильтрованные записи ECG (Numpy файлы и GIFs).
- `arduino nano/`, `arduino_ecg/` — прошивки и конфигурации для ESP32/Arduino.
- `rp/` — скрипты/утилиты для запуска на целевой плате (есть `requirements.txt`).
- `frp/` — инструменты для проброса портов и удалённого доступа (опционально).

---

## Тестирование и валидация

- Добавьте небольшие unit‑тесты для скриптов обработки сигналов в `ai/tests/` при необходимости.
- Для быстрой проверки работы модели можно запускать `ai/main.py` с тестовыми данными из `ecg_data/X_test.npy`.

---

## Лицензия

Предлагается использовать MIT License. Добавьте файл `LICENSE` в корень репозитория при необходимости.

---

## Контакты

Если нужны доработки README или помощь с конкретной частью (прошивка ESP32, настройка MQTT, ускорение инференса на RPi5), создайте issue или напишите PR.

---

Файл создан на основе предоставленного примера. Удачи с проектом — если хотите, могу адаптировать README под конкретные инструкции запуска (например, точные команды для `ai/main.py` или список pip‑зависимостей).